import{b as Q,_ as q,c as w,d as S,Q as A}from"./use-quasar.0c1cb601.js";import{Q as F}from"./QInput.609192af.js";import{x as D,r as I,z as R,a4 as $,aB as j,K as k,A as L,B as U,E as K,a5 as N,U as V,n as O,aG as z,l as G,Y as M,a as T,j as Y,q as H,s as J,u as p,v as c,_ as P,$ as W}from"./index.4fa1aa85.js";import{Q as X}from"./QPage.347ade8f.js";import{u as Z}from"./auth.7326f8e4.js";import"./pinia.a963dac9.js";var ee=D({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(i,{slots:_,emit:f}){const v=K(),t=I(null);let l=0;const n=[];function m(e){const d=typeof e=="boolean"?e:i.noErrorFocus!==!0,b=++l,E=(u,s)=>{f(`validation${u===!0?"Success":"Error"}`,s)},h=u=>{const s=u.validate();return typeof s.then=="function"?s.then(r=>({valid:r,comp:u}),r=>({valid:!1,comp:u,err:r})):Promise.resolve({valid:s,comp:u})};return(i.greedy===!0?Promise.all(n.map(h)).then(u=>u.filter(s=>s.valid!==!0)):n.reduce((u,s)=>u.then(()=>h(s).then(r=>{if(r.valid===!1)return Promise.reject(r)})),Promise.resolve()).catch(u=>[u])).then(u=>{if(u===void 0||u.length===0)return b===l&&E(!0),!0;if(b===l){const{comp:s,err:r}=u[0];if(r!==void 0&&console.error(r),E(!1,s),d===!0){const B=u.find(({comp:C})=>typeof C.focus=="function"&&N(C.$)===!1);B!==void 0&&B.comp.focus()}}return!1})}function o(){l++,n.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function a(e){e!==void 0&&V(e);const d=l+1;m().then(b=>{d===l&&b===!0&&(i.onSubmit!==void 0?f("submit",e):(e==null?void 0:e.target)!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function g(e){e!==void 0&&V(e),f("reset"),O(()=>{o(),i.autofocus===!0&&i.noResetFocus!==!0&&y()})}function y(){Q(()=>{if(t.value===null)return;const e=t.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(t.value.querySelectorAll("[tabindex]"),d=>d.tabIndex!==-1);e==null||e.focus({preventScroll:!0})})}R(z,{bindComponent(e){n.push(e)},unbindComponent(e){const d=n.indexOf(e);d!==-1&&n.splice(d,1)}});let x=!1;return $(()=>{x=!0}),j(()=>{x===!0&&i.autofocus===!0&&y()}),k(()=>{i.autofocus===!0&&y()}),Object.assign(v.proxy,{validate:m,resetValidation:o,submit:a,reset:g,focus:y,getValidationComponents:()=>n}),()=>L("form",{class:"q-form",ref:t,onSubmit:a,onReset:g},U(_.default))}});const ue=G({__name:"LoginPage",setup(i){const _=M(),f=w(),v=Z(),t=T({email:"",password:""}),l=async()=>{var m,o;try{await v.login(t.email,t.password),f.notify({type:"positive",message:"\u0423\u0441\u043F\u0435\u0448\u043D\u044B\u0439 \u0432\u0445\u043E\u0434 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u0443",position:"top"}),_.push({name:"Dashboard"})}catch(a){const g=a;f.notify({type:"negative",message:((o=(m=g.response)==null?void 0:m.data)==null?void 0:o.message)||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438",position:"top"})}},n=Y(()=>v.loading);return(m,o)=>(H(),J(X,{class:"flex flex-center"},{default:p(()=>[c(A,{class:"login-card"},{default:p(()=>[c(S,null,{default:p(()=>o[2]||(o[2]=[P("div",{class:"text-h6"},"\u0412\u0445\u043E\u0434 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u0443",-1)])),_:1,__:[2]}),c(S,null,{default:p(()=>[c(ee,{onSubmit:l,class:"q-gutter-md"},{default:p(()=>[c(F,{modelValue:t.email,"onUpdate:modelValue":o[0]||(o[0]=a=>t.email=a),label:"Email",type:"email",rules:[a=>!!a||"Email \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u0435\u043D"]},null,8,["modelValue","rules"]),c(F,{modelValue:t.password,"onUpdate:modelValue":o[1]||(o[1]=a=>t.password=a),label:"\u041F\u0430\u0440\u043E\u043B\u044C",type:"password",rules:[a=>!!a||"\u041F\u0430\u0440\u043E\u043B\u044C \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u0435\u043D"]},null,8,["modelValue","rules"]),P("div",null,[c(W,{label:"\u0412\u043E\u0439\u0442\u0438",type:"submit",color:"primary",class:"full-width",loading:n.value},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1}))}});var le=q(ue,[["__scopeId","data-v-72a8eb10"]]);export{le as default};
