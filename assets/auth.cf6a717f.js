import{u as l}from"./auth.b1505c31.js";import"./pinia.100cded2.js";import"./index.8c065737.js";async function h(t,i,e){console.log("Auth guard triggered:",{to:t.path,from:i.path});const o=l();!o.token&&localStorage.getItem("token")&&(o.token=localStorage.getItem("token"));const n=window.location.href.match(/\/admin\/([^\/#]+)/);if(n){const r=n[1];console.log("UUID found:",r);const a=await o.autoLogin(r);return console.log("Auto login result:",a),a?e():e({name:"login"})}if(t.name==="login"&&o.isAuthenticated)return e({name:"Dashboard"});if(!o.token)return t.meta.requireAuth?e({name:"login"}):e();if(!o.user)try{if(await o.fetchUser(),!o.user)return o.logout(),e({name:"login"})}catch{return o.logout(),e({name:"login"})}const u=t.meta;if(u.roles&&!u.roles.some(a=>o.hasRole(a)))return e({name:"login"});e()}export{h as authGuard};
